<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Metadata-Based Repositories &bull; EML</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">EML</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ropensci/EML">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Metadata-Based Repositories</h1>
                        <h4 class="author">Carl Boettiger</h4>
            
            <h4 class="date">2016-12-20</h4>
          </div>

    
    
<div class="contents">
<p>One of the principle advantages in creating EML is to make it easier to find the data you need, without having to standardize all your data files themselves into one giant database. Instead, the data files can be whatever you want, provided the relevant information you might search on to discover data of interest is listed in the metadata.</p>
<p>To do this, we will use the <code>dataone</code> package to upload a private copy of our data file to the central data repository.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages("dataone", repos= c("https://cran.rstudio.com", "http://nceas.github.io/drat"))</span>

## or
devtools::<span class="kw">install_github</span>(<span class="kw">c</span>(<span class="st">"ropensci/datapack"</span>, <span class="st">"DataONEorg/rdataone"</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"dataone"</span>)
<span class="kw">library</span>(<span class="st">"datapack"</span>)</code></pre></div>
<p>Imagine we have the file paths to our <code>.csv</code> data file and an <code>.xml</code> EML file providing metadata for it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sampleData &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/sample.csv"</span>, <span class="dt">package=</span><span class="st">"dataone"</span>)
sampleEML &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/sample-eml.xml"</span>, <span class="dt">package=</span><span class="st">"dataone"</span>)</code></pre></div>
<p>To upload these to a metadata repository such as <a href="http://knb.ecoinformatics.org">the KNB</a>, we simply create <code>DataObject</code>s for both files:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataObj &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"DataObject"</span>, <span class="dt">format=</span><span class="st">"text/csv"</span>, <span class="dt">file=</span>sampleData)
metadataObj &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"DataObject"</span>, <span class="dt">format=</span><span class="st">"eml://ecoinformatics.org/eml-2.1.1"</span>, <span class="dt">file=</span>sampleEML)</code></pre></div>
<p>Note that optionally, <code>new("DataObject")</code> could have been given an <code>id</code> argument, which could be a (namespaced) UUID from <code>UUIDgenerate</code>, or a DOI from a member node (see <code>generateIdentifier()</code>). Since no <code>id</code> has been given, a UUID is automatically generated for each.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">accessRules &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">subject=</span><span class="st">"CN=Noam Ross A45991,O=Google,C=US,DC=cilogon,DC=org"</span>, <span class="dt">permission=</span><span class="st">"write"</span>)
dataObj &lt;-<span class="st"> </span><span class="kw">addAccessRule</span>(dataObj, accessRules)
metadataObj &lt;-<span class="st"> </span><span class="kw">addAccessRule</span>(metadataObj, accessRules)</code></pre></div>
<p>We now want to bundle these two objects (data and metadata) into a single &ldquo;data package&rdquo; to be uploaded. To do so, we just create a new <code>DataPackage</code> object and then add the data and metadata using the <code>addData</code> file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dp &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"DataPackage"</span>)
dp &lt;-<span class="st"> </span><span class="kw">addData</span>(dp, dataObj, metadataObj)</code></pre></div>
<p>This both adds the files and registers that the metadata object describes the data object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d1c &lt;-<span class="st"> </span><span class="kw">D1Client</span>(<span class="st">"STAGING"</span>, <span class="st">"urn:node:mnStageUCSB2"</span>)
packageId &lt;-<span class="st"> </span><span class="kw">uploadDataPackage</span>(d1c, dp)</code></pre></div>
<p>Let&rsquo;s see if the ID returned for our package now appears in the DataONE index:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">query</span>(<span class="kw">CNode</span>(<span class="st">"STAGING"</span>), <span class="dt">searchTerms =</span> <span class="kw">list</span>(<span class="dt">id =</span> packageId))</code></pre></div>
<hr><div id="gimme-doi" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#gimme-doi" class="anchor"> </a></body></html>Gimme DOI!</h3>
<p>Note that the example would fail if run here since only the Production (<code>PROD</code>) environment can provide DOIs (the <code>STAGING</code> environment is only for tests and training examples), and only then on member nodes that offer DOIs, such as the KNB (<code>urn:node:KNB</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cn &lt;-<span class="st"> </span><span class="kw">CNode</span>(<span class="st">"STAGING"</span>)
mn &lt;-<span class="st"> </span><span class="kw">getMNode</span>(cn, <span class="st">"urn:node:mnStageUCSB2"</span>)
newid &lt;-<span class="st"> </span><span class="kw">generateIdentifier</span>(mn, <span class="st">"DOI"</span>)</code></pre></div>
<p>We also want to update the EML file itself to use the new id as the <code>packageId</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">eml &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_eml.html">read_eml</a></span>(sampleEML)
eml@packageId &lt;-<span class="st"> </span>newid
<span class="kw"><a href="../reference/write_eml.html">write_eml</a></span>(eml, sampleEML)</code></pre></div>
<p>We can now use the DOI in packaging the DataObject</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">new</span>(<span class="st">"DataObject"</span>, <span class="dt">id =</span> newid, <span class="dt">format =</span> <span class="st">"eml://ecoinformatics.org/eml-2.1.1"</span>, <span class="dt">file=</span>sampleEML)</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Carl Boettiger, Matthew B. Jones.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer></div>

  </body></html>
